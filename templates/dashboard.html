<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker Dashboard</title>
    <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>

<div class="container">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2 class="logo">Expanzo</h2>
        <ul>
            <li class="active">Dashboard</li>
            <li><a href="/transactions" style="color:inherit; text-decoration:none;">Transactions</a></li>
            <li>Budgets</li>
            <li>Reports</li>
            <li>Accounts</li>
            <li>Settings</li>
        </ul>
    </div>

    <!-- MAIN -->
    <div class="main">

        <!-- FLASH MESSAGES -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash {{ category }}">
                {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- TOP BAR -->
        <div class="topbar">
            <h2>Welcome Back, {{ session.username }} ðŸ‘‹</h2>
            <a href="{{ url_for('logout') }}">
                <button class="logout">Logout</button>
            </a>
        </div>

        <!-- TOP CARDS -->
        <div class="cards">
            <div class="card">
                <p>Available Balance</p>
                <h3>â‚¹0</h3>
            </div>

            <div class="card">
                <p>Total Expense</p>
                <h3>â‚¹{{ total_expense }}</h3>
            </div>

            <div class="card">
                <p>Budget Progress</p>
                <h3>0%</h3>
            </div>

            <div class="card streak-card">
                <p>Daily Streak ðŸ”¥</p>
                <h3>{{ streak }} Days</h3>

                <form action="{{ url_for('mark_no_spend') }}" method="POST">
                    <button class="no-spend-btn" {% if already_marked %}disabled{% endif %}>
                        {% if already_marked %}No-Spend Day âœ“{% else %}Mark No-Spend Day{% endif %}
                    </button>
                </form>
            </div>
        </div>

        <!-- EXPENSE SECTION -->
        <div class="expense-box">

            <div class="expense-header">
                <h3>Add Expense</h3>
            </div>

            <!-- ADD EXPENSE FORM -->
            <form action="{{ url_for('add_expense_route') }}" method="POST">
                <div class="expense-form">
                    <input type="date" name="date" required>
                    <input type="number" step="0.01" name="amount" placeholder="Amount" required>

                    <select name="category" required>
                        <option>Food</option>
                        <option>Clothes</option>
                        <option>Bills</option>
                        <option>Travel</option>
                        <option>Other</option>
                    </select>

                    <button type="submit">Add</button>
                </div>
            </form>

            <!-- SEARCH BAR -->
            <div class="expense-search">
                <input type="text" placeholder="Search (date/category)">
            </div>

            <div class="expense-header" style="padding-top: 20px;">
                <h3>Recent Transactions</h3>
            </div>

            <!-- EXPENSE TABLE -->
            <table class="expense-table">
                <thead>
                    <tr>
                        <th>Sr.No</th>
                        <th>Date</th>
                        <th>Category</th>
                        <th>Amount (â‚¹)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in expenses %}
                    <tr>
                        <td><strong>{{ loop.index }}</strong></td>
                        <td>{{ e.expense_date }}</td>
                        <td>{{ e.category }}</td>
                        <td>{{ e.amount }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align:center;">No expenses yet</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>
</div>

</body>
</html>
